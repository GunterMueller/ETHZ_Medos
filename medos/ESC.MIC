. Microcode for printer instructions. ----------------------------------.  N.Wirth    5.11.81 / 20.5.82..  PROCEDURE PCH(bma: ADDRESS; VAR x: CARDINAL; y: CARDINAL;.                font: Frame; ch: CHAR);.     CODE 246B; 1.  END PCH;..  PROCEDURE REC(bma: ADDRESS; x,y,w,h: CARDINAL);.     CODE 246B; 2.  END REC;..  PROCEDURE CLR(n, m: CARDINAL; buf: ADDRESS);.     CODE 246B; 3.  END CLR;..  Bitmap is 2048 bits (128 words) wide, 256 lines high.  y coordinate counts from top down.  y coordinate wraps around, i.e. is taken MOD 256.  w and h must be > 0.  CLR clears lines m, m+1, ... , m+n-1 (MOD 256) of buffer...ORG 4000.MAP 246ZERO = 0RAM = 6000.ESC       1 Q   OR  DZ 0  -  -  -  - -  -   - 0 ALU IR   Q := IR          0 RAM        Z             -  JMP          1 Q   -+  ZQ 0  -  -  -  - -  -   - 0 -   -    Q := Q-1          0 PCH        Z             -  JMP          1 Q   -+  ZQ 0  -  -  -  - -  -   - 0 -   -    Q := Q-1          0 REC        Z             -  JMP          1 Q   -+  ZQ 0  -  -  -  - -  -   - 0 -   -    Q := Q-1          0 CLR        Z             -  JMP          0 ZERO       Z             -  JMP..ORG 6022 ----------------------------.PCH       1 B    +  DA 0  T  0  -  - -  -   S 0 POP -    R0 := STK+T  fontAdr          1 B*  OR  DZ 0  0  0  R 16 -  -   - 0 ALU ALU  R0 := 4*R0          1 B    &  DA 0  0 10  -  - -  -   - 1 3        R8 := fontFrame          1 B   -&  DA 0  0  0  -  - -  -   - 1 3        R0 := fontAdr          1 -   OR  ZA 0 10  -  -  - -  -   - 0 BNK ALU            1 Q   OR  ZA 0  0  -  -  - -  -   - 0 MAR ALU  MAR := Q := R0          1 B   OR  DZ 0  -  3  -  - -  -   - 0 ALU MD   R3 := MD   w          1 -   OR  ZA 0 10  -  -  - -  -   - 0 BNK ALU            1 Q    +  ZQ 1  -  -  -  - -  -   - 0 MAR ALU  MAR := Q := Q+1          1 B   OR  DZ 0  -  1  -  - -  -   - 0 ALU MD   R1 := MD     (oy,ox)          1 -   OR  ZA 0 10  -  -  - -  -   - 0 BNK ALU            1 Q    +  ZQ 1  -  -  -  - -  -   - 0 MAR ALU  MAR := Q := Q+1          1 B    &  DA 0  1  5  -  - -  -   - 1 377      R5 := R1 MOD 256  ox          0 L0        -H             -  JMP          1 B   OR  DA 0  5  5  R 10 -  -   - 1 377      sign extensionL0        1 B*  OR  DZ 0  1  1  R 10 -  -   - 0 ALU ALU  R1 := R1^8          1 B    +  DA 0  1  1  -  - -  -   S 0 POP -    R1 := STK+R1    y+oy          1 B    &  DA 0  1  1  -  - -  -   - 1 377      R1 := R1 MOD 256          1 B   OR  DZ 0  -  7  -  - -  -   - 0 ALU MD   R7 := MD       dy,dx          1 B*  OR  DZ 0  1  1  R 11 -  -   - 0 ALU ALU  R1 := R1*128          1 B   OR  DZ 0  -  T  -  - -  -   S 0 MAR ALU  MAR := T := STK   @x          1 B    &  DA 0  7  6  -  - -  -   - 1 377      R6 := R7 MOD 256  dx          1 B*  OR  DZ 0  7  7  R 10 -  -   - 0 ALU ALU  R7 := R7^8          1 B   OR  DZ 0  -  0  -  - -  -   - 0 ALU MD   R0 := MD           x          1 B   OR  DZ 0  -  4  -  - -  -   S 0 POP -    R4 := STK        bma          1 -    +  AB 0  0  3  -  - -  -   - 0 MD  ALU  MD := R0+R3      x+w          1 B*  OR  DZ 0  T  T  -  - -  -   S 0 MAR ALU  MAR := T; T := STK          1 B    &  DA 0  7  7  -  - -  -   - 1 377      R7 := R7 MOD 256  dy          0 quit       Z             -  JMP              invalid char          1 B    +  AB 0  0  5  -  - -  -   - 0 SR  ALU  SR := R5 := R0+R5 x+ox          1 B   -&  DA 0  5  2  -  - -  -   - 1 17       R2 := R5 -& 17          1 B*  OR  DZ 0  2  2  R  4 -  -   - 0 ALU ALU  R2 := R2^4 (x+ox)/16          1 B    &  DA 0  5  3  -  - -  -   - 1 17       R3 := R5 MOD 16          1 -   OR  ZA 0 10  -  -  - -  -   - 0 BNK ALU            1 Q    +  ZQ 1  -  -  -  - -  -   - 0 MAR ALU  MAR := Q := Q+1          1 B    +  AB 0  2  1  -  - -  -   - 0 -   -    R1 := R1+R2      Y          1 -   OR  ZA 0 11  -  -  - -  -   S 0 PSH -    STK := R9  (save)          1 Q    +  DQ 0  -  -  -  - -  -   - 0 ALU MD   Q := MD+Q  @rasterVLoop     1 B   -&  DA 0  1  5  M  1 -  -   - 1 0        R5 := R1 MOD 40000B          1 B    &  ZA 0  0  T  -  - -  -   - 0 -   -    T := 0          1 B   OR  ZA 0  6  11 -  - -  -   - 0 -   -    R9 := R6       dx.HLoop     1 -   OR  ZA 0 10  -  -  - -  -   - 0 BNK ALU            1 Q    +  ZQ 1  -  -  -  - -  -   - 0 MAR ALU  MAR := Q := Q+1          1 B   OR  DZ 0  -  0  RR - -  -   - 0 ALU MD   R0 := MD^SR  raster          1 -    +  AB 0  4  5  -  - -  -   - 0 MAR ALU  MAR := R4+R5          1 B   -&  DA 0  0  2  MR - -  -   - 1 0        R2 := R0 & -MSK(0,SR)          1 B   OR  AB 0  2  T  -  - -  -   - 0 -   -    T := T OR R2          1 B   OR  DA 0  T  T  -  - -  -   - 0 ALU MD   T := T OR MD          1 -   OR  ZA 0  T  -  -  - -  -   - 0 MD  ALU  MD := T          1 -    +  AB 0  4  5  -  - -  -   - 0 MAR ALU  MAR := R4+R5          1 B    +  ZA 1  5  5  -  - -  -   - 0 -   -    R5 := R5+1          1 B    &  DA 0  0  T  MR - -  -   - 1 0        T := R0 & MSK(0,SR)          1 B   -+  DA 1 11 11  -  - -  -   - 1 20       R9 := R9 - 16          0 HLoop     -ZS            -  JMP.          1 -    +  AB 0 11  3  -  - -  -   - 0 -   -    R9+R3        dx+xb          0 L1         ZS            -  JMP          1 -    +  AB 0  4  5  -  - -  -   - 0 MAR ALU  MAR := R4+R5          1 B   OR  DA 0  T  T  -  - -  -   - 0 ALU MD   T := T OR MD          1 -   OR  ZA 0  T  -  -  - -  -   - 0 MD  ALU  MD := T          1 -    +  AB 0  4  5  -  - -  -   - 0 MAR ALU  MAR := R4+R5L1        1 B    +  DA 0  1  1  -  - -  -   - 1 200      R1 := R1 + 200B          1 B   -+  ZA 0  7  7  -  - -  -   - 0 -   -    R7 := R7-1     dy          0 VLoop     -ZS            -  JMP   .          1 B   OR  DZ 0  - 11  -  - -  -   S 0 POP -    R9 := STK  (restore)quit      1 Q   OR  DZ 0  -  -  -  - S  JMP - 0 ALU IR4  JMAP..ORG 6233 -------------------------------.CLR       1 B   OR  DZ 0  -  1  -  - -  -   S 0 POP -    R1 := STK  (adr)          1 B   OR  DZ 0  -  0  -  - -  -   S 0 POP -    R0 := STK  (cnt)          0 C2         Z             -  JMPC0        1 B    &  DA 0  1  1  -  - -  -   - 1 377      R1 := R1 MOD 256          1 B*  OR  DZ 0  1  2  R 11 -  -   - 0 ALU ALU  R2 := R1 * 128          1 B    +  AB 0  T  2  -  - -  -   - 0 -   -    R2 := T+R2 (+org)          1 B   OR  DZ 0  -  3  -  - -  -   - 1 200      R3 := 128C1        1 -    &  ZA 0  0  -  -  - -  -   - 0 MD  ALU  MD := 0          1 B*   +  ZA 1  2  2  -  - -  -   - 0 MAR ALU  MAR := R2; R2 := R2+1          1 B   -+  ZA 0  3  3  -  - -  -   - 0 -   -    R3 := R3-1          0 C1        -Z             -  JMP          1 B    +  ZA 1  1  1  -  - -  -   - 0 -   -    R1 := R1+1          1 B   -+  ZA 0  0  0  -  - -  -   - 0 -   -    R0 := R0-1          0 C0        -Z             -  JMPC2        1 B   OR  DZ 0  -  T  -  - -  -   S 0 POP -    T := STK          1 Q   OR  DZ 0  -  -  -  - S  JMP - 0 ALU IR4  JMAP..ORG 6323 -------------------------------.REC       1 B   OR  DZ 0  -  0  -  - -  -   S 0 POP -    R0 := w          1 B   OR  DZ 0  -  1  -  - -  -   S 0 POP -    R1 := y          1 B    &  DA 0  1  1  -  - -  -   - 1 377      R1 := R1 MOD 400B          1 B*  OR  DZ 0  1  1  R 11 -  -   - 0 ALU ALU  R1 := R1 * 128          1 B   OR  DZ 0  -  2  -  - -  -   S 0 SR  ALU  R2 := SR := x          1 B   -&  DA 0  2  3  -  - -  -   - 1 17          1 B*  OR  DZ 0  3  3  R  4 -  -   - 0 ALU ALU  R3 := x DIV 16          1 B    +  AB 0  3  1  -  - -  -   - 0 -   -    R1 := R1+R3          1 B  -XR  DZ 0  -  6  MR - -  -   - 1 0        R6 := {xb..15}          1 B    &  DA 0  2  2  -  - -  -   - 1 17       R2 := R2 MOD 16          1 B    +  AB 0  2  0  -  - -  -   - 0 SR  ALU  SR := R0 := R0+R2 w+xb          1 B   OR  DZ 0  -  7  MR - -  -   - 1 0        R7 := {0..xb+w-1}          0 L2         -Z            -  JMP          1 B   -+  AB 0  7  7  -  - -  -   - 0 -   -    corr, if R0 = 16L2        1 B   OR  DZ 0  -  3  -  - -  -   S 0 POP -    R3 := mapadr          1 Q   OR  DZ 0  -  -  -  - -  -   S 0 POP -    Q  := STK dummy          1 B   -+  DA 1  0  0  -  - -  -   - 1 20       R0 := R0-16          0 I1         -ZS           -  JMP              GOTO I1 IF > 0          1 B    &  AB 0  6  7  -  - -  -   - 0 -   -    R7 := {xb..xb+w-1}R1        1 -    +  AB 0  3  1  -  - -  -   - 0 MAR ALU  MAR := R1+R3          1 B   OR  DA 0  7  2  -  - -  -   - 0 ALU MD   R2 := MD OR R7          1 -   OR  ZA 0  2  -  -  - -  -   - 0 MD  ALU  MD := R2          1 -    +  AB 0  1  3  -  - -  -   - 0 MAR ALU  MAR := R1+R3          1 B    +  DA 0  1  1  -  - -  -   - 1 200      R1 := R1 + 128          1 B   -&  DA 0  1  1  R  1 -  -   - 1 1        R1 := R1 MOD 256*128          1 B   -+  ZA 0  T  T  -  - -  -   - 0 -   -    T := T-1   h          0 R1         -Z            -  JMP              REPEAT IF # 0          1 Q   OR  DZ 0  -  -  -  - S  JMP - 0 ALU IR4  JMAP.I1        1 B   -+  DA 1  0  0  -  - -  -   - 1 20       R0 := R0-16          0 I2         -ZS           -  JMP              GOTO I2 IF > 0.R2        1 -    +  AB 0  3  1  -  - -  -   - 0 MAR ALU  MAR := R1+R3          1 B   OR  DA 0  6  2  -  - -  -   - 0 ALU MD   R2 := MD OR R6          1 -   OR  ZA 0  2  -  -  - -  -   - 0 MD  ALU  MD := R2          1 -    +  AB 0  1  3  -  - -  -   - 0 MAR ALU  MAR := R1+R3          1 -    +  AB 1  1  3  -  - -  -   - 0 MAR ALU  MAR := R1+R3+1          1 B   OR  DA 0  7  2  -  - -  -   - 0 ALU MD   R2 := MD OR R7          1 -   OR  ZA 0  2  -  -  - -  -   - 0 MD  ALU  MD := R2          1 -    +  AB 1  1  3  -  - -  -   - 0 MAR ALU  MAR := R1+R3+1          1 B    +  DA 0  1  1  -  - -  -   - 1 200      R1 := R1 + 128          1 B   -&  DA 0  1  1  R  1 -  -   - 1 1        R1 := R1 MOD 256*128          1 B   -+  ZA 0  T  T  -  - -  -   - 0 -   -    T := T-1   h          0 R2         -Z            -  JMP              REPEAT IF # 0          1 Q   OR  DZ 0  -  -  -  - S  JMP - 0 ALU IR4  JMAP.I2        1 B   OR  ZA 0  0  5  -  - -  -   - 0 -   -    R5 := R0          1 -    +  AB 0  3  1  -  - -  -   - 0 MAR ALU  MAR := R1+R3          1 B   OR  DA 0  6  2  -  - -  -   - 0 ALU MD   R2 := MD OR R6          1 -   OR  ZA 0  2  -  -  - -  -   - 0 MD  ALU  MD := R2          1 Q    +  AB 0  1  3  -  - -  -   - 0 MAR ALU  MAR := Q := R1+R3R3        1 -  -XR  AB 0  0  0  -  - -  -   - 0 MD  ALU  MD := 177777B          1 Q    +  ZQ 1  -  -  -  - -  -   - 0 MAR ALU  MAR := Q := Q+1          1 B   -+  DA 1  5  5  -  - -  -   - 1 20       R5 := R5-16          0 R3         -ZS           -  JMP              REPEAT IF > 0          1 Q    +  ZQ 1  -  -  -  - -  -   - 0 MAR ALU  MAR := Q := Q+1          1 B   OR  DA 0  7  2  -  - -  -   - 0 ALU MD   R2 := MD OR R7          1 -   OR  ZA 0  2  -  -  - -  -   - 0 MD  ALU  MD := R2          1 -   OR  ZQ 0  -  -  -  - -  -   - 0 MAR ALU  MAR := Q          1 B    +  DA 0  1  1  -  - -  -   - 1 200      R1 := R1 + 128          1 B   -&  DA 0  1  1  R  1 -  -   - 1 1        R1 := R1 MOD 256*128          1 B   -+  ZA 0  T  T  -  - -  -   - 0 -   -    T := T-1   h          0 I2         -Z            -  JMP              REPEAT IF # 0          1 Q   OR  DZ 0  -  -  -  - S  JMP - 0 ALU IR4  JMAP